__xx_get_gitlab_projects() {
    local DB_PATH="${XX_CACHE_DIR}/gitlab.db"

    if [[ -f "${DB_PATH}" ]]; then
        # Get the most recent cache timestamp
        local LATEST_TIMESTAMP=$(sqlite3 "${DB_PATH}" "SELECT MAX(sync_timestamp) FROM SyncLog WHERE operation='gitlab_projects';" 2>/dev/null)
        if [ -n "${LATEST_TIMESTAMP}" ]; then
            echo "Last cached: ${LATEST_TIMESTAMP}"
        else
            echo "Last cached: Never"
        fi

        # Query all projects from all hosts
        sqlite3 --json "${DB_PATH}" "SELECT project,id,web_url,hostname FROM Projects ORDER BY project" | \
            jq -r '(["PROJECT","ID","URL","HOST"] | @csv) , (.[] | [.project, .id, .web_url, .hostname] | @csv)' | sed 's/"//g' | column -t -s','
    else
        echo "gitlab.db doesn't exist"
        echo "Run CTRL+R to cache GitLab projects"
    fi
}
