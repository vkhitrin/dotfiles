__xx_preview_aws_iam_policy() {
    local POLICY_ARN="$1"
    if [[ -n "${AWS_SESSION_TOKEN}" && -n "${AWS_VAULT}" ]]; then
        echo "=== Policy Details ==="
        aws iam get-policy --policy-arn "${POLICY_ARN}" --output json 2>/dev/null | \
            jq -r '
                .Policy |
                "Policy Name: \(.PolicyName)\n" +
                "Policy ARN: \(.Arn)\n" +
                "Policy ID: \(.PolicyId)\n" +
                "Path: \(.Path)\n" +
                "Create Date: \(.CreateDate)\n" +
                "Update Date: \(.UpdateDate)\n" +
                "Attachment Count: \(.AttachmentCount)\n" +
                "Permissions Boundary Usage Count: \(.PermissionsBoundaryUsageCount)\n" +
                "Default Version: \(.DefaultVersionId)\n" +
                "Description: \(.Description // "N/A")"
            '

        local VERSION_ID=$(aws iam get-policy --policy-arn "${POLICY_ARN}" --output json 2>/dev/null | jq -r '.Policy.DefaultVersionId')

        if [[ -n "${VERSION_ID}" ]]; then
            echo -e "\n=== Policy Document (${VERSION_ID}) ==="
            aws iam get-policy-version --policy-arn "${POLICY_ARN}" --version-id "${VERSION_ID}" --output json 2>/dev/null | \
                jq -r '.PolicyVersion.Document | @json | fromjson | tostring' | \
                jq -C '.' 2>/dev/null || echo "Unable to parse policy document"
        fi

        echo -e "\n=== Attached To ==="
        echo "Roles:"
        aws iam list-entities-for-policy --policy-arn "${POLICY_ARN}" --entity-filter Role --output json 2>/dev/null | \
            jq -r '.PolicyRoles[]? | "  • \(.RoleName)"' || echo "  None"

        echo "Users:"
        aws iam list-entities-for-policy --policy-arn "${POLICY_ARN}" --entity-filter User --output json 2>/dev/null | \
            jq -r '.PolicyUsers[]? | "  • \(.UserName)"' || echo "  None"

        echo "Groups:"
        aws iam list-entities-for-policy --policy-arn "${POLICY_ARN}" --entity-filter Group --output json 2>/dev/null | \
            jq -r '.PolicyGroups[]? | "  • \(.GroupName)"' || echo "  None"
    else
        echo "AWS vault is not enabled."
    fi
}
